{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h1 class="main-header">{{ title }}</h1>

    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–Ω–∞–ª–∏–∑–µ</h5>
                    <p class="card-text">
                        <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–∫–∞–Ω—Å–∏–π –≤ –∞–Ω–∞–ª–∏–∑–µ:</strong>
                        {% if stat.data_count %}
                            {{ stat.data_count }}
                        {% else %}
                            {{ vacancy_count }}
                        {% endif %}<br>

                        {% if last_search_query %}
                            <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å:</strong> "{{ last_search_query.query }}"
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    {% if stat.error %}
        <div class="alert alert-warning">
            <h5> –í–Ω–∏–º–∞–Ω–∏–µ!</h5>
            <p>{{ stat.error }}</p>
            {% if stat.data_count %}
                <p><strong>–ù–∞–π–¥–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π:</strong> {{ stat.data_count }}</p>
            {% endif %}
        </div>
    {% else %}

        {% if stat.regression_plot %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</h5>
                    </div>
                    <div class="card-body">
                        <img src="data:image/png;base64,{{ stat.regression_plot }}"
                             alt="–†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑" class="img-fluid rounded">
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if stat.r_squared %}
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h2 class="display-6">{{ stat.r_squared|floatformat:3 }}</h2>
                        <p class="text-muted">R-–∫–≤–∞–¥—Ä–∞—Ç</p>
                        <div class="small">
                            {% if stat.r_squared > 0.7 %}
                                <span class="badge bg-success">–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</span>
                            {% elif stat.r_squared > 0.5 %}
                                <span class="badge bg-warning">–•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ</span>
                            {% else %}
                                <span class="badge bg-danger">–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h2 class="display-6">{{ stat.adj_r_squared|floatformat:3 }}</h2>
                        <p class="text-muted">–°–∫–æ—Ä—Ä–µ–∫—Ç. R¬≤</p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5>–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏:</h5>
                        <ul class="small">
                            <li><strong>R-–∫–≤–∞–¥—Ä–∞—Ç</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –º–æ–¥–µ–ª—å –æ–±—ä—è—Å–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞—Ä–ø–ª–∞—Ç–∞—Ö</li>
                            <li><strong>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π R¬≤</strong> —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–∫—Ç–æ—Ä–æ–≤</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}


        {% if stat.coefficients %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">–í–ª–∏—è–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç—É</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>–§–∞–∫—Ç–æ—Ä</th>
                                    <th>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</th>
                                    <th>–í–ª–∏—è–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody>

                                {% if 'experience' in stat.coefficients %}
                                <tr>
                                    <td>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</td>
                                    <td class="fw-bold">
                                        {{ stat.coefficients.experience|floatformat:0 }} —Ä—É–±.
                                    </td>
                                    <td>
                                        {% if stat.coefficients.experience > 0 %}
                                            <span class="text-success">‚Üë –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% elif stat.coefficients.experience < 0 %}
                                            <span class="text-danger">‚Üì –£–º–µ–Ω—å—à–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% else %}
                                            <span class="text-muted">–ë–µ–∑ –≤–ª–∏—è–Ω–∏—è</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if 'experience' in stat.p_values and stat.p_values.experience < 0.05 %}
                                            <span class="badge bg-success">–ó–Ω–∞—á–∏–º—ã–π</span>
                                            <small class="text-muted">(p={{ stat.p_values.experience|floatformat:4 }})</small>
                                        {% else %}
                                            <span class="badge bg-warning">–ù–µ–∑–Ω–∞—á–∏–º—ã–π</span>
                                            {% if 'experience' in stat.p_values %}
                                            <small class="text-muted">(p={{ stat.p_values.experience|floatformat:4 }})</small>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}

                                {% if 'education' in stat.coefficients %}
                                <tr>
                                    <td>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</td>
                                    <td class="fw-bold">
                                        {{ stat.coefficients.education|floatformat:0 }} —Ä—É–±.
                                    </td>
                                    <td>
                                        {% if stat.coefficients.education > 0 %}
                                            <span class="text-success">‚Üë –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% elif stat.coefficients.education < 0 %}
                                            <span class="text-danger">‚Üì –£–º–µ–Ω—å—à–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% else %}
                                            <span class="text-muted">–ë–µ–∑ –≤–ª–∏—è–Ω–∏—è</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if 'education' in stat.p_values and stat.p_values.education < 0.05 %}
                                            <span class="badge bg-success">–ó–Ω–∞—á–∏–º—ã–π</span>
                                            <small class="text-muted">(p={{ stat.p_values.education|floatformat:4 }})</small>
                                        {% else %}
                                            <span class="badge bg-warning">–ù–µ–∑–Ω–∞—á–∏–º—ã–π</span>
                                            {% if 'education' in stat.p_values %}
                                            <small class="text-muted">(p={{ stat.p_values.education|floatformat:4 }})</small>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}


                                {% if 'platform' in stat.coefficients %}
                                <tr>
                                    <td>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</td>
                                    <td class="fw-bold">
                                        {{ stat.coefficients.platform|floatformat:0 }} —Ä—É–±.
                                    </td>
                                    <td>
                                        {% if stat.coefficients.platform > 0 %}
                                            <span class="text-success">‚Üë –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% elif stat.coefficients.platform < 0 %}
                                            <span class="text-danger">‚Üì –£–º–µ–Ω—å—à–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É</span>
                                        {% else %}
                                            <span class="text-muted">–ë–µ–∑ –≤–ª–∏—è–Ω–∏—è</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if 'platform' in stat.p_values and stat.p_values.platform < 0.05 %}
                                            <span class="badge bg-success">–ó–Ω–∞—á–∏–º—ã–π</span>
                                            <small class="text-muted">(p={{ stat.p_values.platform|floatformat:4 }})</small>
                                        {% else %}
                                            <span class="badge bg-warning">–ù–µ–∑–Ω–∞—á–∏–º—ã–π</span>
                                            {% if 'platform' in stat.p_values %}
                                            <small class="text-muted">(p={{ stat.p_values.platform|floatformat:4 }})</small>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}

                                {% if 'const' in stat.coefficients %}
                                <tr>
                                    <td>–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç—ã</td>
                                    <td class="fw-bold">
                                        {{ stat.coefficients.const|floatformat:0 }} —Ä—É–±.
                                    </td>
                                    <td>
                                        <span class="text-info">–ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">–ë–∞–∑–æ–≤–∞—è –ª–∏–Ω–∏—è</span>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                        <p class="text-muted small">
                            <strong>–ü–æ—è—Å–Ω–µ–Ω–∏–µ:</strong> –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∞ –ø–æ–≤—ã—à–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É.
                            P-–∑–Ω–∞—á–µ–Ω–∏–µ &lt; 0.05 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é –∑–Ω–∞—á–∏–º–æ—Å—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∞.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if stat.insights %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for insight in stat.insights %}
                            <li class="list-group-item">{{ insight|safe }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

    {% endif %}

    <div class="row mt-4">
        <div class="col-md-12">
            <a href="{% url 'statistics' %}" class="btn btn-secondary">
                –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
            </a>
        </div>
    </div>
</div>
{% endblock %}